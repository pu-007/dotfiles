%% Pandoc Custom Template for CTeX
\documentclass[12pt,a4paper]{ctexart}

% --- 基础宏包 ---
\usepackage{microtype}
\usepackage{xcolor}
\usepackage{amsmath,amssymb}
\usepackage{setspace}
\usepackage{geometry}
% --- 强制首行缩进 ---
\usepackage{indentfirst}      % 强制第一段也缩进
\setlength{\parindent}{2em}   % 设置缩进量为2个字符宽度

\usepackage{graphicx}

% --- 表格支持 ---
\usepackage{array}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{calc}

% --- 修复 Pandoc 必须的宏定义 ---
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

\usepackage[hidelinks]{hyperref}

% --- 页面几何与行距 ---
\geometry{a4paper,left=2cm,top=0.5cm,right=0.5cm,bottom=0.5cm}
\setstretch{1.4}

% --- 字体设置 ---
\usepackage{fontspec}
\setmainfont{JetXW}[Fallback = {Noto Sans, Noto Sans Symbols 2}]
\setsansfont{JetXW}[Fallback = {Noto Sans, Noto Sans Symbols 2}]
\setmonofont{JetXW}[Fallback = {Noto Sans Mono, Noto Sans Symbols 2}]
\setCJKmainfont{JetXW}[Fallback = {Noto Sans CJK SC, Noto Sans Symbols 2}]

% --- 标题样式定制 (已移除编号) ---
\usepackage[explicit]{titlesec} 

\setlength{\arrayrulewidth}{0.5pt}
\renewcommand{\arraystretch}{1.3}

% 禁止 LaTeX 对章节进行计数（双重保险）
\setcounter{secnumdepth}{0}

% H1: 深灰背景 + 白字 (移除 \thesection)
\titleformat{\section}[block]
{\Large\bfseries\color{white}}
{} % 标签位留空
{0pt}
{\colorbox{black!80}{\parbox{\dimexpr\textwidth-2\fboxsep\relax}{#1}}} % 仅输出标题内容

% H2: 浅灰背景 + 黑字 (移除 \thesubsection)
\titleformat{\subsection}[block]
{\large\bfseries}
{}
{0pt}
{\colorbox{black!10}{\parbox{\dimexpr\textwidth-2\fboxsep\relax}{#1}}}

% H3: 底部实线 (移除 \thesubsubsection)
\titleformat{\subsubsection}[hang]
{\normalsize\bfseries}
{} % 标签为空
{0pt} % 间距为0
{#1}
[{\titlerule[0.8pt]}]

% H4: 底部虚线 (移除 \theparagraph)
\titleformat{\paragraph}[hang]
{\normalsize\bfseries}
{} % 标签为空
{0pt} % 间距为0
{#1}
[{\titlerule*[0.5pc]{-}}]

% 调整标题间距
\titlespacing*{\section}{0pt}{1.5ex plus 1ex minus .2ex}{1ex plus .2ex}
\titlespacing*{\subsection}{0pt}{1.5ex plus 1ex minus .2ex}{1ex plus .2ex}
\titlespacing*{\subsubsection}{0pt}{1.5ex plus 1ex minus .2ex}{1ex plus .2ex}
\titlespacing*{\paragraph}{0pt}{1ex plus 1ex minus .2ex}{0.5ex plus .2ex}

% --- 代码高亮 ---
$if(highlighting-includes)$
$highlighting-includes$
$endif$

% --- Header Includes ---
$for(header-includes)$
$header-includes$
$endfor$

\begin{document}

$if(title)$
\maketitle
$endif$

$if(toc)$
\tableofcontents
\newpage
$endif$

$body$

$if(references)$
\section*{References}
$references$
$endif$

\end{document}
